(()=>{"use strict";function e(e,t,o){const n=a();if(e.due==n){const n=document.createElement("li");n.id=e.id,n.classList.add("project-li"),n.innerText=`${e.name}, ${e.due}`,t.appendChild(n),o?(n.id=o,c(o,n)):c(e.id,n)}}function t(e,t,o){const n=a();if(e.due==n){const n=document.createElement("li");n.id=e.id,n.classList.add("task-li"),n.innerText=`${e.name}, ${e.due}`,t.appendChild(n),o?(n.id=o,c(o,n)):c(o,n)}}function o(e){const t=[{tag:"input",type:"text",id:"name",name:"name",elClass:"popup-input",placeholder:`${e} name`,container:"popup-top-container"},{tag:"input",type:"date",id:"due",name:"due",elClass:"popup-input",container:"popup-bot-container"},{tag:"select",id:"priority",name:"priority",elClass:"popup-input",container:"popup-bot-container"},{tag:"button",text:`Add ${e}`,elClass:`${e}-input-btn`,container:"popup-bot-container"},{tag:"button",text:"x",elClass:"exit-popup-button",container:"popup-top-container"}];r([{tag:"div",elClass:"popup-form",container:document.body},{tag:"div",elClass:"popup-top-container",container:"popup-form"},{tag:"div",elClass:"popup-bot-container",container:"popup-form"}]),r(t),i(["important","semi-important","normal"],"priority")}function n(){r([{tag:"div",elClass:"select-popup-container",container:document.body}]),r([{tag:"button",text:"Add Project",elClass:"select-project-btn",container:"select-popup-container"},{tag:"button",text:"Add Task",elClass:"select-task-btn",container:"select-popup-container"},{tag:"button",text:"x",elClass:"exit-select-button",container:"select-popup-container"}])}function r(e){e.forEach(({tag:e,type:t,id:o,name:n,placeholder:r,elClass:i,container:a,text:c})=>{const d=document.createElement(e);t&&(d.type=t),o&&(d.id=o),n&&(d.name=n),r&&(d.placeholder=r),i&&d.classList.add(i),c&&(d.textContent=c),a==document.body?a.appendChild(d):document.querySelector(`.${a}`).appendChild(d)})}function i(e,t){const o=document.querySelector(`#${t}`);e.forEach(e=>{const t=document.createElement("option");t.innerText=e,o.appendChild(t)})}function a(){let e=new Date;const t=String(e.getDate()).padStart(2,"0"),o=String(e.getMonth()+1).padStart(2,"0");return String(e.getFullYear())+"-"+o+"-"+t}function c(e,t){const o=document.createElement("input");o.setAttribute("type","checkbox"),o.id=e,t.appendChild(o)}function d(e,t){const o=document.body,n=e.parentNode.id,a=e.parentNode.classList[0].split("-")[0];console.log(a,n);const c=t(a,n);r([{tag:"div",elClass:"edit-window-container",container:o}]),r([{tag:"input",type:"text",id:"name",name:"name",elClass:"edit-window-input",container:"edit-window-container"},{tag:"input",type:"date",id:"due",name:"due",elClass:"edit-window-input",container:"edit-window-container"},{tag:"select",id:"priority",name:"priority",elClass:"edit-window-input",container:"edit-window-container"},{tag:"button",text:"Delete",elClass:"edit-window-del-btn",container:"edit-window-container"},{tag:"button",text:"Save",elClass:"edit-window-save-btn",container:"edit-window-container"},{tag:"button",text:"x",elClass:"edit-window-exit-btn",container:"edit-window-container"}]),i(["important","semi-important","normal"],"priority"),document.querySelectorAll(".edit-window-input").forEach(e=>{"name"==e.name&&(e.value=c.name),"due"==e.name&&(e.value=c.due),"priority"==e.name&&(e.value=c.priority)})}function s(){return{initStorage:function(){localStorage.getItem("projects")?function(e,t,o){const n=JSON.parse(localStorage.getItem("projects"));if(0==n.length)return;const r=document.querySelector(".sidebar-projects-list"),i=document.querySelector(".field-projects-list");n.forEach(n=>{e(n,r,o),t(n,i)})}(m.rendProject,m.rendTodayProject,f.editWindEventLis):localStorage.setItem("projects",JSON.stringify([])),localStorage.getItem("tasks")?function(e,t,o){const n=JSON.parse(localStorage.getItem("tasks"));if(0==n.length)return;const r=document.querySelector(".sidebar-tasks-list"),i=document.querySelector(".field-tasks-list");n.forEach(n=>{e(n,r,o),t(n,i)})}(m.rendTask,m.rendTodayTask,f.editWindEventLis):localStorage.setItem("tasks",JSON.stringify([]))},removeFromStorage:function(e,t){let o=JSON.parse(localStorage.getItem(`${e}s`))||[];o=o.filter(e=>e.id!==t),localStorage.setItem(`${e}s`,JSON.stringify(o))}}}const l=function(){let e=[],t=[];return{addProjectToList:function(t){e.push(t)},addTaskToList:function(e){t.push(e)},getProjects:function(){return e},getTasks:function(){return t},removeProject:function(t){e.forEach((o,n)=>{o.name==t&&(e=e.slice(n,1))})},removeTask:function(e){t.forEach((o,n)=>{o.name==e&&(t=t.slice(n,1))})},getLastProject:function(){return e.at(-1)},getLastTask:function(){return t.at(-1)},getProperties:function(o,n){const r={};return"task"==o?t.forEach(e=>{e.id==n&&(r.name=e.name,r.due=e.due,r.priority=e.priority)}):"project"==o?e.forEach(e=>{e.id==n&&(r.name=e.name,r.due=e.due,r.priority=e.priority)}):console.error("inappropriate type"),r},editProperties:function(o,n,r){"task"==o?t.forEach(e=>{e.id==n&&(e.name=r.name,e.due=r.due,e.priority=r.priority)}):"project"==o?e.forEach(e=>{e.id==n&&(e.name=r.name,e.due=r.due,e.priority=r.priority)}):console.error("inappropriate type")},getOneProperty:function(o,n,r){"task"==o?t.forEach(e=>{if(e.id==n)return e[r]}):"project"==o?e.forEach(e=>{if(e.id==n)return e[r]}):console.error("inappropriate type")}}}(),u=s(),p={sidebarProjectsList:document.querySelector(".sidebar-projects-list"),sidebarTasksList:document.querySelector(".sidebar-tasks-list"),fieldProjectsList:document.querySelector(".field-projects-list"),fieldTasksList:document.querySelector(".field-tasks-list")},m={rendTask:function(e,t,o,n){const r=document.createElement("li");r.classList.add("task-li"),r.id=e.id;const i=document.createElement("button");i.classList.add("sidebar-li-btn"),i.innerText=`#${e.name}`,r.appendChild(i),t.appendChild(r),o(i,d),n&&n("tasks",e)},rendTodayTask:t,rendProject:function(e,t,o,n){const r=document.createElement("li");r.classList.add("project-li"),r.id=e.id;const i=document.createElement("button");i.classList.add("sidebar-li-btn"),i.innerText=`#${e.name}`,r.appendChild(i),t.appendChild(r),o(i,d),n&&n("projects",e)},rendTodayProject:e,getLastTask:l.getLastTask,getLastProject:l.getLastProject,addTaskToList:l.addTaskToList,addProjectToList:l.addProjectToList,getAllProjects:l.getProjects,getAllTasks:l.getTasks,completeTaskOrProject:function(e,t,o){const n=e.id,r=e.parentNode.classList[0].split("-")[0],i=t(),a=[...document.querySelectorAll("li")].filter(e=>e.id.includes(n));i.forEach((e,t)=>{n==e.id&&i.splice(t,1)}),a.forEach(e=>e.remove()),o(r,n)},getProperties:l.getProperties,updateEntry:function(e,t,o){const n=document.querySelectorAll(".edit-window-input"),r={};n.forEach(e=>{"name"==e.name&&(r.name=e.value),"due"==e.name&&(r.due=e.value),"priority"==e.name&&(r.priority=e.value)}),o(e,t,r)},editProperties:l.editProperties,getTodayDate:a,removeProject:l.removeProject,removeTask:l.removeTask,deleteEntryFromDom:function(e){e.forEach(e=>e.remove())},editElements:function(o,n,r,i,a){const c=document.querySelector(`.field-${i}s-list`);o.forEach(o=>{o.parentNode.classList.contains("ul-field")?n.due!==r?o.remove():o.innerText="task"==i?`>${n.name}, ${n.due}`:`#${n.name}, ${n.due}`:"task"==i?(o.children[0].innerText=`>${n.name}`,n.due==r&&t(n,c,a)):"project"==i&&(o.children[0].innerText=`#${n.name}`,n.due==r&&e(n,c,a))})},getOneProp:l.getOneProperty,removeFromStorage:u.removeFromStorage},f=(()=>{const e=[document.querySelector(".add-select-btn"),document.querySelector(".add-project-btn"),document.querySelector(".add-task-btn")],t=document.querySelectorAll(".ul-field"),o=["getLast Placeholder","rend Placeholder","sidebar Placeholder sList","rendToday Placeholder","field Placeholder sList","add Placeholder ToList"],n={};function r(e){try{for(let e in n)delete n[e];const t=document.querySelectorAll(".popup-input"),o=document.querySelector(".popup-form"),r=m[e.getLastPlaceholder],i=m[e.rendPlaceholder],a=p[e.sidebarPlaceholdersList],s=m[e.rendTodayPlaceholder],l=p[e.fieldPlaceholdersList],u=m[e.addPlaceholderToList];t.forEach(e=>{n[e.id]=e.value,n.id=crypto.randomUUID()}),document.body.removeChild(o),u(n),i(r(),a,c,d),s(r(),l)}catch(e){throw e}}function i(e,t){const o=e[0].toUpperCase()+e.slice(1,e.length),n=t.map(e=>e.replace("Placeholder",o).split(" ").join("")),r={};return n.forEach(e=>{r[e.replace(o,"Placeholder")]=e}),r}function a(e,t){t(e.target,m.getProperties),function(e){const t=e.parentNode.id,o=e.parentNode.classList[0].split("-")[0],n=document.querySelector(".edit-window-container"),r=[...document.querySelectorAll("li")].filter(e=>e.id.includes(t)),a=document.querySelector(".edit-window-exit-btn"),c=document.querySelector(".edit-window-save-btn"),d=document.querySelector(".edit-window-del-btn");a.addEventListener("click",()=>n.remove()),c.addEventListener("click",()=>function(){m.updateEntry(o,t,m.editProperties);const e=m.getProperties(o,t),i=m.getTodayDate();m.editElements(r,e,i,o,t),n.remove()}()),d.addEventListener("click",()=>function(){const e=i(o,["getAll Placeholder s","remove Placeholder"]),a=m[e.getAllPlaceholders](),c=m[e.removePlaceholder];a.forEach(e=>{e.id==t&&(c(e.name),m.deleteEntryFromDom(r),m.removeFromStorage(o,e.id))}),n.remove()}())}(e.target)}function c(e,t){e.addEventListener("click",e=>{a(e,t)})}function d(e,t){if("projects"==e){const e=JSON.parse(localStorage.getItem("projects"))||[];e.push(t),localStorage.setItem("projects",JSON.stringify(e))}else{const e=JSON.parse(localStorage.getItem("tasks"))||[];e.push(t),localStorage.setItem("tasks",JSON.stringify(e))}}return{inputsObj:n,arrOfBtns:e,noSelectPopupHandler:function(e,t){const n=e.target.classList[0].split("-")[1],a=i(n,o);t(n);const c=document.querySelector(".exit-popup-button"),d=document.querySelector(".popup-form");c.addEventListener("click",()=>d.remove()),document.querySelector(`.${n}-input-btn`).addEventListener("click",()=>r(a))},checkedInputHandler:function(e){const t=e.parentNode.classList[0].split("-")[0],o=t[0].toUpperCase()+t.slice(1,t.length),n=m[`getAll${o}s`];e.checked&&m.completeTaskOrProject(e,n,m.removeFromStorage)},ulField:t,selectPopupHandler:function(e,t){e();const n=document.querySelector(".exit-select-button"),a=document.querySelector(".select-popup-container");[document.querySelector(".select-task-btn"),document.querySelector(".select-project-btn"),n].forEach(e=>{e.addEventListener("click",e=>{if("exit-select-button"==e.target.classList)a.remove();else{a.remove();const n=e.target.classList[0].split("-")[1],c=i(n,o);t(n);const d=document.querySelector(`.${n}-input-btn`),s=document.querySelector(".exit-popup-button"),l=document.querySelector(".popup-form");s.addEventListener("click",()=>l.remove()),d.addEventListener("click",()=>r(c))}})})},editWindowHandler:a,saveInStorage:d,editWindEventLis:c}})();s().initStorage(),f.arrOfBtns.forEach(e=>{e.addEventListener("click",e=>{"add-select-btn"==e.target.classList?f.selectPopupHandler(n,o):f.noSelectPopupHandler(e,o)})}),f.ulField.forEach(e=>{e.addEventListener("change",e=>{"checkbox"===e.target.type&&e.target.checked&&f.checkedInputHandler(e.target)})}),window.addEventListener("storage",e=>{f.storageSaveEvent(e)})})();